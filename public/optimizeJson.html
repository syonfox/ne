<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GeoJSON Tools</title>
</head>
<body>
<h1>GeoJSON Tools</h1>
<input type="file" id="loadGeoJSON" accept=".json">
<div id="fieldsSelection"></div>
<button id="removePropertiesBtn">Remove Selected Properties</button>
<button id="exportTopoJSONBtn">Export to TopoJSON</button>
<button id="exportGeoJSONSplitBtn">Export GeoJSON Split</button>

<script>
    let geojsonData = null;

    document.getElementById('loadGeoJSON').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            geojsonData = JSON.parse(event.target.result);
            populateFieldsSelection(geojsonData);
        };
        reader.readAsText(file);
    });

    function populateFieldsSelection(data) {
        const fieldsSet = new Set();
        data.features.forEach(feature => {
            Object.keys(feature.properties).forEach(key => {
                fieldsSet.add(key);
            });
        });
        const fieldsSelection = document.getElementById('fieldsSelection');
        fieldsSelection.innerHTML = ''; // Clear previous
        fieldsSet.forEach(field => {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = field;
            checkbox.value = field;
            const label = document.createElement('label');
            label.htmlFor = field;
            label.appendChild(document.createTextNode(field));
            fieldsSelection.appendChild(checkbox);
            fieldsSelection.appendChild(label);
            fieldsSelection.appendChild(document.createElement('br'));
        });
    }

    document.getElementById('removePropertiesBtn').addEventListener('click', function() {
        const selectedFields = [...document.querySelectorAll('#fieldsSelection input')]
            .filter(input => input.checked)
            .map(input => input.value);
        removeProperties(selectedFields);
    });

    function removeProperties(propertiesToRemove) {
        if (!geojsonData) return;
        geojsonData.features.forEach(feature => {
            propertiesToRemove.forEach(prop => {
                delete feature.properties[prop];
            });
        });
        console.log('Properties removed:', propertiesToRemove);
        // You might want to re-render the field selection or update the UI in some way here.
    }

    // Stub for exporting to TopoJSON - this would require an external library or server-side processing
    document.getElementById('exportTopoJSONBtn').addEventListener('click', function() {
        console.log('Exporting to TopoJSON...');
        // Implementation needed
    });

    // Stub for exporting GeoJSON split - Implement your logic based on your specific splitting criteria
    document.getElementById('exportGeoJSONSplitBtn').addEventListener('click', function() {
        console.log('Exporting GeoJSON Split...');
        // Implementation needed
    });



</script>
</body>
</html>
